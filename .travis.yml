# Configure.
language: python
python:
  - 3.6
  - 3.4
  - 3.3
  - pypy
  - 2.7
services:
  - redis-server
  - rabbitmq
sudo: false

# Environment and matrix.
env:
  - BROKER=sqlite RESULT=sqlite LOCK=sqlite
  - BROKER=mysql RESULT=mysql LOCK=mysql
  - BROKER=rabbit RESULT=redis LOCK=redis
  - BROKER=rabbit RESULT=redis LOCK=filesystem
  - BROKER=postgres RESULT=postgres LOCK=postgres
  - BROKER=redis RESULT=redis LOCK=redis
  - BROKER=redis_sock RESULT=redis_sock LOCK=redis_sock
matrix:
  include:
    - python: 3.6
      services: []
      env: TOX_ENV=lint
      before_script: []
      after_success: []

# Run.
install: pip install tox
before_script:
  - ./testdata/travis/setup.sh

script: tox -e ${TOX_ENV:-py}
after_success:
  - bash <(curl -s https://codecov.io/bash)

# Deploy.
deploy:
  provider: pypi
  user: Robpol86
  password:
    secure:
      "liwn5bHqjAtW+gRX6r4VgWuc44OUwfGSne4fTxb6G2pnPNW/IneVspQ2bFXeuQDdXzyLoOe\
      bKa8bxjRurUEHedjV9UG9fVZwVsWU981aWOxeEl+6kLkpJ2fE9UVeK7T1O+RzzhkWhHq2/YL\
      4BjBqzOLuBSAGnXZAnwH55Z6HY2g="
  on:
    condition: $TRAVIS_PYTHON_VERSION = 3.6
    tags: true
